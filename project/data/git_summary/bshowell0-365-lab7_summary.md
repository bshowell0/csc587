### Overall Summary

This repository, `bshowell0-365-lab7`, contains the source code for a command-line interface (CLI) application for a hotel reservation system. Written in Python, the application serves as a front-end to a MySQL database, allowing users to perform several key operations related to hotel bookings. The project is well-structured, separating concerns into distinct modules for user interaction, database requests, and input validation.

The primary functionalities offered to the user are:
1.  **FR1 (Rooms and Rates):** Displays a list of all available rooms, their properties (bed type, max occupancy, decor), base price, and a calculated popularity score. It also shows the next available check-in date for each room.
2.  **FR2 (Reservations):** An interactive workflow for creating a new reservation. The user provides their name, desired room code and bed type (or 'Any'), check-in/check-out dates, and the number of guests. The system then presents available rooms that match the criteria. A key feature is its ability to suggest alternative rooms or dates if the initial request cannot be fulfilled.
3.  **FR3 (Reservation Cancellation):** Allows a user to cancel an existing reservation by providing its unique reservation code.
4.  **FR4 (Detailed Reservation Information):** A powerful search tool to find existing reservations. Users can search by any combination of first name, last name, date range, room code, or reservation number, with support for SQL wildcards (`%`, `_`).
5.  **FR5 (Revenue):** Generates a monthly revenue report for the current year. It calculates the total revenue generated by each room for each month and displays it in a pivot table, including monthly and yearly totals.

The application's architecture is centered around `main.py`, which acts as the main controller. It handles database connection using credentials from a `.env` file and runs a primary loop that listens for user commands. The `src` directory contains the core logic:
-   `src/printer.py`: Manages all console input and output. It uses the `pandas` library to format and display database query results in clean, readable tables. It's also responsible for printing menus with ANSI escape codes for better readability and clearing the console screen.
-   `src/request.py`: Contains all the SQL logic. Each function in this module corresponds to a feature, constructing and executing complex SQL queries against the `lab7_rooms` and `lab7_reservations` tables.
-   `src/validate.py`: Provides functions to validate and sanitize all user input, from simple menu commands to complex date formats and search strings, ensuring the application is robust against invalid data.

Technologically, the project leverages `mysql-connector-python` for database communication, `python-dotenv` for managing configuration, and `pandas` for sophisticated data manipulation and presentation. The use of complex SQL queries with Common Table Expressions (CTEs) and advanced date logic is a notable aspect of the backend implementation.

### Key Code and Structure Details

**1. `main.py`: The Application Controller**
The entry point of the application establishes a single, persistent database connection and cursor that are passed down to the request functions. This is an efficient approach that avoids reconnecting for every query. The core of the file is a `while` loop that drives the user interaction.

```python
def main():
    # ... database connection ...
    printer.welcome()
    usr = printer.usr()
    while not validate.quit(usr):
        if validate.fr1(usr):
            request.fr1(cursor)
        elif validate.fr2(usr):
            request.fr2(cursor, conn)
        # ... other elif branches for FR3, FR4, FR5 ...
        else:
            printer.invalid()
        usr = printer.usr("\n")
    # ... close connection ...
```
This structure creates a simple but effective routing mechanism. It uses validation functions (`validate.frX`) to interpret flexible user input (e.g., 'res' or 'reservations' for FR2) and dispatches the call to the appropriate function in the `request` module.

**2. `src/printer.py`: Sophisticated UI and Data Display**
This module is responsible for the entire user interface. It uses `pandas` extensively to present data, which is a significant step up from manual string formatting.

-   **Menu Generation:** The `usr()` function uses ANSI escape codes to create an underlined, user-friendly menu, and it clears the screen before each prompt for a clean interface.
-   **Revenue Report Generation (`fr5`):** This function showcases a powerful use of `pandas`. It receives a list of reservations for the year, and instead of complex SQL, it performs the data transformation in Python. It "explodes" each reservation (which has a start and end date) into a series of rows, one for each day of the stay. Then, it uses `pivot_table` to aggregate the daily revenue by room and month, creating a comprehensive report with totals.

```python
def fr5(result):
    df = pd.DataFrame(result, columns=["Room", "Rate", "CheckIn", "Checkout"])
    # ... convert to datetime objects ...
    df['Date'] = df.apply(lambda row: pd.date_range(start=row['CheckIn'], end=row['Checkout'] - pd.Timedelta(days=1), freq='D'), axis=1)
    df = df.explode('Date')
    df['DailyRevenue'] = df['Rate']
    df['Month'] = df['Date'].dt.month
    # ... create pivot table ...
    pivot = df.pivot_table(index='Room', columns='Month', values='DailyRevenue', aggfunc='sum', fill_value=0)
    # ... add totals and print ...
    print(pivot)
```

-   **Reservation Cost Calculation (`fr2_res`):** This function dynamically calculates the total cost of a stay, correctly applying a 10% surcharge for weekend nights (Fridays and Saturdays).

**3. `src/request.py`: Complex SQL and Business Logic**
This module contains the most complex code, especially the SQL queries.

-   **FR1 Popularity Score Query:** The `fr1` function uses a Common Table Expression (CTE) to first calculate a `PopularityScore` for each room. This score is derived from the proportion of the last 180 days that the room was occupied. This is a non-trivial query that demonstrates an understanding of advanced SQL.

```sql
WITH reservation_data AS (
  SELECT
    Room,
    COALESCE(ROUND(COUNT(DATEDIFF(CheckIn, Checkout))/180, 2), 0) AS PopularityScore,
    MIN(CASE WHEN Checkout >= CURDATE() THEN Checkout END) + INTERVAL 1 DAY AS NextAvailableCheckIn,
    -- ...
  FROM
    bshowell.lab7_reservations
  WHERE
    CheckIn >= DATE_SUB(CURDATE(), INTERVAL 180 DAY)
  GROUP BY
    Room
)
SELECT -- ...
```

-   **FR2 Smart Reservation Suggestions (`fr2_res_empty`):** This is arguably the most impressive feature. When a user's exact reservation request cannot be met, this function is called. It doesn't just fail; it runs a series of three distinct SQL queries to find the best possible alternatives:
    1.  **Alternative Dates:** It finds the soonest available future time slot for the user's desired room type and stay length.
    2.  **Alternative Rooms:** It finds up to 5 other rooms that are available during the user's *original* requested date range.
    3.  **Filling Gaps:** It searches for any gaps between existing reservations across all rooms that are long enough to accommodate the user's stay.
    The results from these queries are combined using `pandas.concat`, and the top 5 suggestions are presented to the user. This demonstrates a sophisticated problem-solving approach to improve user experience.

-   **FR4 Flexible Search Query:** The query in `fr4` is built dynamically based on user input. It constructs a `WHERE` clause by adding conditions only for the fields the user provided, allowing for highly flexible searching. It correctly uses `LIKE` for string matching and handles date range searches.

**4. `src/validate.py`: Robust Input Validation**
This module ensures the application doesn't crash on bad input. The `fr2_req` and `fr4_req` functions are particularly important. They parse a dictionary of choices, applying different rules (isalpha, isdigit, regex for dates) to each field. The date validation is thorough, checking both the `YYYY-MM-DD` format and logical consistency (e.g., start date is before end date, and reservation dates are in the future).

```python
def fr4_req(choices):
    # ...
    elif key == "date":
        dates = [choice.strip() for choice in choices[key].split("to")]
        if len(dates) > 2:
            raise ValueError("Too many dates...")
        for date in dates:
            if not re.match(r"\d{4}-\d{2}-\d{2}", date) or not is_valid_date(date):
                raise ValueError("Invalid date format...")
        if len(dates) == 2 and not is_valid_date(dates[0]) < is_valid_date(dates[1]):
            raise ValueError("Start date must be before end date.", dates)
        choices["date"] = dates
    # ...
```
